(window["webpackJsonpexpenses-react"]=window["webpackJsonpexpenses-react"]||[]).push([[11],{730:function(e,t,a){"use strict";a.r(t);var n=a(21),r=a(20),c=a(6),i=a.n(c),u=a(12),s=a(13),l=a(0),o=a.n(l),d=a(5),m=a(66),p=a.n(m),f=a(11),h=a(710),b=a(708),g=a(38),v=a(52),y=a(29),E=a(39),O=d.a.create({errorText:{color:"red",width:"95%"}});t.default=function(){var e=Object(g.b)(),t=e.getFile,a=e.initializing,c=p()(),m=c.history,j=c.match,w="/sheet/:sheetId/edit/:expenseId"===j.path,x=Object(h.a)({defaultValues:{}}),C=x.errors,I=x.handleSubmit,k=x.register,D=x.reset,T=x.setValue,S=x.watch,q=Object(b.a)({promiseFn:v.a.getExpenseById,sheetId:j.params.sheetId,expenseId:j.params.expenseId}),N=q.data,F=q.isPending,R=Object(b.a)({promiseFn:v.a.getMetadata,sheetId:j.params.sheetId}),V=R.data,A=R.isPending,U=Object(l.useState)(),z=Object(s.a)(U,2),M=z[0],P=z[1],Y=Object(l.useState)(!1),G=Object(s.a)(Y,2),J=G[0],B=G[1],W=Object(l.useState)([]),_=Object(s.a)(W,2),H=_[0],K=_[1],L=Object(l.useState)(0),Q=Object(s.a)(L,2),X=Q[0],Z=Q[1];Object(l.useEffect)((function(){return window.scrollTo(0,0)}),[]),Object(l.useEffect)((function(){var e=function(){var e=Object(u.a)(i.a.mark((function e(t){var a,n,r,c,u,s,l,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],n=t.files||[],r=0;case 3:if(!(r<n.length)){e.next=32;break}return c=n[r].url,u=c,e.prev=6,e.next=9,v.a.getFile(n[r].url);case 9:u=e.sent,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(6);case 14:if(Object(E.g)(n[r])){e.next=17;break}return a.push({url:c,name:n[r].name,publicUrl:u,thumb:""}),e.abrupt("continue",29);case 17:return s="thumb_".concat(n[r].url.substring(n[r].url.lastIndexOf("/")+1)),l="".concat(n[r].url.substring(0,n[r].url.lastIndexOf("/")+1)),o="".concat(l).concat(s),e.prev=20,e.next=23,v.a.getFile("".concat(l).concat(s));case 23:o=e.sent,e.next=28;break;case 26:e.prev=26,e.t1=e.catch(20);case 28:a.push({url:c,name:n[r].name,publicUrl:u,thumb:o});case 29:r++,e.next=3;break;case 32:K(a);case 33:case"end":return e.stop()}}),e,null,[[6,12],[20,26]])})));return function(t){return e.apply(this,arguments)}}();if(!a&&!F&&!M&&V)if(w)if(N){var t=Object(r.a)({},N,{date:new Date(+N.date)});P(t),D(t),e(N)}else{var n={date:new Date};P(n),D(n)}else{var c=Object.keys(V.cities||{}).find((function(e){return V.cities[e].default})),s=Object.keys(V.categories||{}).find((function(e){return V.categories[e].default})),l=Object.keys(V.currencies||{}).find((function(e){return V.currencies[e].default})),o=Object.keys(V.methods||{}).find((function(e){return V.methods[e].default})),d={date:new Date,city:c,category:s,currency:l,method:o};P(d),D(d)}}),[w,j.params.expenseId,a,F,t,N,V,M,D]);var $=Object(E.i)(V,"cities"),ee=Object(E.i)(V,"categories"),te=Object(E.i)(V,"currencies"),ae=Object(E.i)(V,"methods"),ne=Object(E.d)(V).tags;if(!V)return o.a.createElement(y.i,{loading:F||J||A,fullScreen:!0},o.a.createElement("div",null));var re=function(){var e=Object(u.a)(i.a.mark((function e(t){var a,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.date,c=Object(n.a)(t,["date"]),(u=Object(r.a)({date:new Date(a).getTime()},c)).dateNeg=-u.date,w&&(u.id=j.params.expenseId),u.files=H,B(!0),e.next=8,v.a.upsertExpense({sheetId:j.params.sheetId,item:u,metadata:V});case 8:D(),m.push("/sheet/".concat(j.params.sheetId));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(e){return C[e]&&o.a.createElement("span",{className:Object(d.b)(O.errorText)},C[e].message||"Required field")},ie=((void 0!==S("tags")?S("tags"):M?M.tags:"")||"").split(",").filter((function(e){return!!e})).map((function(e){return{id:e,name:e}}));return o.a.createElement(y.i,{loading:F||J||A,fullScreen:!0},o.a.createElement(f.Column,{style:{padding:25,marginTop:5},horizontal:"center"},o.a.createElement(f.Column,{style:{width:"100%",maxWidth:500}},o.a.createElement("h1",null,w?"Edit Expense":"Add Expense"),o.a.createElement(y.d,{name:"date",selected:S("date")?new Date(S("date")):(M||{}).date?new Date((M||{}).date):new Date,onChange:function(e){return T("date",e)},value:S("date")}),o.a.createElement("input",{name:"date",ref:k({required:!0}),type:"hidden"}),ce("date"),o.a.createElement(y.a,{onChange:function(e,t){var a=t.newValue;return T("city",a)},placeholder:"CITY",value:S("city",(M||{}).city||""),values:$}),o.a.createElement("input",{name:"city",ref:k({required:!0}),type:"hidden"}),ce("city"),o.a.createElement(y.a,{onChange:function(e,t){var a=t.newValue;return T("category",a)},placeholder:"CATEGORY",value:S("category",(M||{}).category||""),values:ee}),o.a.createElement("input",{name:"category",ref:k({required:!0}),type:"hidden"}),ce("category"),o.a.createElement(y.h,{name:"description",placeholder:"DESCRIPTION",onChange:function(e){return T("description",e.target.value)},ref:k({required:!0}),autoComplete:"off"}),ce("description"),o.a.createElement(y.o,{onAddition:function(e){var t=ie.slice(0);t.find((function(t){return t.name===e.name}))||(t.push(e),T("tags",t.map((function(e){return e.name})).join(",")))},onDelete:function(e){var t=ie.slice(0);t.splice(e,1),T("tags",t.map((function(e){return e.name})).join(","))},suggestions:ne,tags:ie}),o.a.createElement("input",{name:"tags",ref:k({}),type:"hidden"}),ce("tags"),o.a.createElement(y.h,{type:"number",name:"amount",placeholder:"AMOUNT",onChange:function(e){return T("amount",e.target.value)},ref:k({required:!0,validate:function(e){return!isNaN(Number(e))||"Debe ingresar un numero"}}),autoComplete:"off"}),ce("amount"),o.a.createElement(y.a,{onChange:function(e,t){var a=t.newValue;return T("currency",a)},placeholder:"CURRENCY",value:S("currency",(M||{}).currency||""),values:te}),o.a.createElement("input",{name:"currency",ref:k({required:!0}),type:"hidden"}),ce("currency"),o.a.createElement(y.a,{onChange:function(e,t){var a=t.newValue;return T("method",a)},placeholder:"Method",value:S("method",(M||{}).method||""),values:ae}),o.a.createElement("input",{name:"method",ref:k({required:!0}),type:"hidden"}),ce("method"),(!w||w&&N)&&o.a.createElement(y.f,{onChange:function(e){return Z(X+1),K(e)},files:H,filesChanged:X,hasFiles:!!w&&(N.files||[]).length>0}),o.a.createElement(f.Row,{flexGrow:1,style:{marginTop:20},horizontal:"spaced"},o.a.createElement(y.b,{color:"red",label:"Cancel",onClick:function(){return m.push("/sheet/".concat(j.params.sheetId))}}),o.a.createElement(y.b,{color:"green",label:w?"Save":"Add Expense",onClick:I(re)})))))}}}]);
//# sourceMappingURL=11.63e6e30e.chunk.js.map